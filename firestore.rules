rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper Functions
    function isSignedIn() {
      return request.auth != null;
    }

    function isOwner(userId) {
      return isSignedIn() && request.auth.uid == userId;
    }

    // Collection: users
    // Users can read and write to their own document.
    // This is used to store profile information.
    match /users/{userId} {
      allow read, update, delete: if isOwner(userId);
      allow create: if isSignedIn();

      // Subcollection: orders
      // Users can manage their own orders. They can create, read, update,
      // and delete their own orders, but cannot access others'.
      match /orders/{orderId} {
        allow read, list, create, update, delete: if isOwner(userId);
      }
    }

    // Collection: curtains
    // This is the public product catalog. Anyone can read the curtains,
    // but nobody can write to them from the client-side.
    match /curtains/{curtainId} {
      allow get, list: if true;
      allow create, update, delete: if false; // Managed by admins from a backend environment
    }
    
    // Collection: contactFormSubmissions
    // Anyone can create a contact form submission. No one can read them
    // from the client-side for privacy reasons.
    match /contactFormSubmissions/{submissionId} {
        allow create: if true;
        allow read, list, update, delete: if false;
    }
  }
}
