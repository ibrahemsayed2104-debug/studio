/**
 * This ruleset is for the 'Fabrics' curtain store application.
 *
 * Core Philosophy:
 * With user authentication disabled, the security model is simplified. Data is either public,
 * write-only, or accessible via a known identifier (like an order ID).
 *
 * Data Structure:
 * - /curtains: Public catalog, read-only for clients.
 * - /contact_form_entries: Write-only for public contact form.
 * - /orders: Allows creation by anyone, read access by anyone, and status updates by the admin (from the app).
 *
 * Key Security Decisions:
 * - Public Catalog: `/curtains` is publicly readable. Writes are disabled.
 * - Write-Only Contact Form: `/contact_form_entries` allows creation, denies all reads.
 * - Order Security:
 *   - Anyone can create an order (`create: if true`).
 *   - A specific order can be read by anyone (`get: if true`).
 *   - Listing all documents in the `orders` collection is denied for privacy (`list: if false`).
 *   - Updates are allowed ONLY if the new 'status' field is one of the predefined values. This allows the
 *     store owner to update the order status from the app without exposing other order data to modification.
 *   - Deletes are disabled from the client-side for data integrity.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Publicly readable catalog of curtain products. Writes are disabled.
     */
    match /curtains/{curtainId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
_     * @description Stores submissions from the public contact form.
     */
    match /contact_form_entries/{contactFormEntryId} {
      allow create: if true;
      allow get, list, update, delete: if false;
    }
    
    /**
     * @description Stores customer orders.
     * @path /orders/{orderId}
     * @allow (create, get) Anyone can place and view a specific order.
     * @allow (update) Only the 'status' field can be updated to a valid status.
     * @deny (list, delete) Listing all orders and deleting are denied.
     */
    match /orders/{orderId} {
      allow create, get: if true;
      allow update: if request.resource.data.status in ['قيد المعالجة', 'تم الشحن', 'تم التوصيل', 'تم استلام الطلب', 'ملغي'];
      allow list, delete: if false;
    }
  }
}
