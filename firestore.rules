/**
 * This ruleset is for the 'Fabrics' curtain store application.
 *
 * Core Philosophy:
 * With user authentication disabled, the security model is simplified. Data is either public,
 * write-only, or accessible via a known identifier (like an order ID). The orders collection
 * is now listable for an admin-like experience.
 *
 * Data Structure:
 * - /curtains: Public catalog, read-only for clients.
 * - /contact_form_entries: Write-only for public contact form.
 * - /orders: Allows creation by anyone, read and list access by anyone for admin purposes. Status can be updated.
 *
 * Key Security Decisions:
 * - Public Catalog: `/curtains` is publicly readable. Writes are disabled.
 * - Write-Only Contact Form: `/contact_form_entries` allows creation, denies all reads.
 * - Order Security:
 *   - Anyone can create an order (`create: if true`).
 *   - A specific order can be read by anyone (`get: if true`).
 *   - Listing all documents in `orders` is now allowed for the admin dashboard view (`list: if true`).
 *   - Updates are allowed ONLY if the new 'status' field is one of the predefined values.
 *   - Deletes are disabled from the client-side for data integrity.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Publicly readable catalog of curtain products. Writes are disabled.
     */
    match /curtains/{curtainId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
_     * @description Stores submissions from the public contact form.
     */
    match /contact_form_entries/{contactFormEntryId} {
      allow create: if true;
      allow get, list, update, delete: if false;
    }
    
    /**
     * @description Stores customer orders.
     * @path /orders/{orderId}
     * @allow (create, get, list) Anyone can place an order and anyone can view/list orders for admin UI.
     * @allow (update) Only the 'status' field can be updated to a valid status.
     * @deny (delete) Deleting is denied.
     */
    match /orders/{orderId} {
      allow create, get, list: if true;
      allow update: if request.resource.data.status in ['قيد المعالجة', 'تم الشحن', 'تم التوصيل', 'تم استلام الطلب', 'ملغي'];
      allow delete: if false;
    }
  }
}
